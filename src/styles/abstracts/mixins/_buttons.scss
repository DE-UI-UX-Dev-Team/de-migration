@use "sass:map";  
@use "sass:string";
 
@use '../../abstracts/' as *;
@use '../../abstracts/base/buttons-map' as *;
@use '../../abstracts/tokens' as *; 
@use '../functions/string-replace.scss' as *;

@mixin getButtonsOnColorBg( $targetBackgroundType ) {
     
    $backgroundClasses: ();

    @if( $targetBackgroundType == "dark-backgrounds" ) {  
        $targetBackgroundType: "dark-bg";
        $backgroundClasses: $darkBackgroundClasses;  
    } 
    @else if( $targetBackgroundType == "light-backgrounds" ) {
        $targetBackgroundType: "light-bg";
        $backgroundClasses: (""); // Placeholder because we only need the loop to run once
    } 
    @else {
        $backgroundClasses: $alertBackgroundClasses; 
    }

    @each $bgClass in $backgroundClasses { 
        
        $suffix: "drk-bg";  
        $bgSelector: "[class*=#{$bgClass}] "; 

        @if $targetBackgroundType == "light-bg" { 
            $suffix: "lgt-bg";  
            $bgSelector: "";
        }

        @if $bgClass == "bg--success-background" or 
            $bgClass == "bg--warning-background" or 
            $bgClass == "bg--error-background" or 
            $bgClass == "bg--info-background" 
        {
            $suffix: str-replace( str-replace($bgClass, "bg--", ""), "-background", "-bg" );  
        }

        @each $backgroundType, $palette in map.get($buttonsOnContrastingBg, #{$active-theme}) {   
            @if( 
                $backgroundType == $targetBackgroundType or
                $backgroundType == $suffix
            ) {
                @each $button, $states in $palette { 
                    @each $state, $properties in $states {  

                        // Primary Buttons
                        @if $button == "primary" { 
                            @if $state == "default" {
                                #{$bgSelector}.btn--#{$button}, 
                                #{$bgSelector}input[type="submit"], 
                                #{$bgSelector}label[type="submit"] {
                                    @each $property, $value in $properties{
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                } 
                            }
                            @else{
                                #{$bgSelector}.btn--#{$button}:#{$state}, 
                                #{$bgSelector}input[type="submit"]:#{$state}, 
                                #{$bgSelector}label[type="submit"]:#{$state},
                                #{$bgSelector}label[type="submit"]:#{$state} > input[type="submit"] {
                                    @each $property, $value in $properties{
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                }
                            } 
                        }  
                        
                        // Secondary Button/HTML Button Elements
                        @else if $button == "secondary" {
                            @if $state == "default" {
                                #{$bgSelector}button,
                                #{$bgSelector}.btn, 
                                #{$bgSelector}input[type="button"],
                                #{$bgSelector}input[type="reset"], 
                                #{$bgSelector}label[type="button"],
                                #{$bgSelector}label[type="reset"], 
                                #{$bgSelector}.btn--#{$button}{
                                    @each $property, $value in $properties{
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                } 
                            }
                            @else{
                                #{$bgSelector}button:#{$state},  
                                #{$bgSelector}.btn:#{$state},
                                #{$bgSelector}input[type="reset"]:#{$state}, 
                                #{$bgSelector}input[type="button"]:#{$state},  
                                #{$bgSelector}label[type="button"]:#{$state},
                                #{$bgSelector}label[type="reset"]:#{$state},  
                                #{$bgSelector}label[type="button"]:#{$state} > input[type="button"],
                                #{$bgSelector}label[type="reset"]:#{$state} > input[type="reset"],
                                #{$bgSelector}.btn--#{$button}:#{$state}{
                                    @each $property, $value in $properties{
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                } 
                            }
                        } 

                        // Buttons with Classname
                        @else if string.index($button, '.') != null { 
                            $prop-prefix: str-replace($button, '.', '');
                            @if $state == "default" {
                                #{$bgSelector}button#{$button},
                                #{$bgSelector}[class*=btn]#{$button},
                                #{$bgSelector}input[type="button"]#{$button},
                                #{$bgSelector}input[type="reset"]#{$button} 
                                #{$bgSelector}label[type="button"]#{$button},
                                #{$bgSelector}label[type="reset"]#{$button} {
                                    @each $property, $value in $properties{ 
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                } 
                            }
                            @else{
                                #{$bgSelector}button#{$button}:#{$state},
                                #{$bgSelector}[class*=btn]#{$button}:#{$state},
                                #{$bgSelector}[type="button"]#{$button}:#{$state},
                                #{$bgSelector}[type="reset"]#{$button}:#{$state}, 
                                #{$bgSelector}label[type="button"]#{$button}:#{$state},
                                #{$bgSelector}label[type="reset"]#{$button}:#{$state} {
                                    @each $property, $value in $properties{ 
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                } 
                            }
                        }
                        
                        // Every other button type
                        @else {
                            @if $state == "default" {
                                #{$bgSelector}.btn--#{$button}{
                                    @each $property, $value in $properties{
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                } 
                            }
                            @else{
                                #{$bgSelector}.btn--#{$button}:#{$state}{
                                    @each $property, $value in $properties{
                                        @if $value != null {
                                            #{$property}: #{$value};
                                        }
                                    }
                                } 
                            }
                        }
                    } // End loop - properties


                } // End loop - palette
            } // End if - targetBackgroundType
        } // End loop - $buttonsOnContrastingBg
    } // End loop - backgroundClasses
} // End mixin